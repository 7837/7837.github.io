<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Jemes Zhou</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录自己的成长">
<meta property="og:type" content="website">
<meta property="og:title" content="Jemes Zhou">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jemes Zhou">
<meta property="og:description" content="记录自己的成长">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jemes Zhou">
<meta name="twitter:description" content="记录自己的成长">
  
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/undefined" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Jemes Zhou</a></h1>
		</hgroup>

		
		<p class="header-subtitle">为梦想加油</p>
		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Jemes Zhou</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/undefined" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Jemes Zhou</h1>
			</hgroup>
			
			<p class="header-subtitle">为梦想加油</p>
			
			<nav class="header-menu">
				<ul>
				
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-租赁VPS搭建私人VPN" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/租赁VPS搭建私人VPN/" class="article-date">
  	<time datetime="2016-08-29T09:36:55.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/租赁VPS搭建私人VPN/">租赁VPS搭建私人VPN</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="租赁VPS搭建私人VPN"><a href="#租赁VPS搭建私人VPN" class="headerlink" title="租赁VPS搭建私人VPN"></a>租赁VPS搭建私人VPN</h1><hr>
<blockquote>
<ul>
<li>作为一名IT，资料收集应该算是必备技能，强大的长城防火墙阻挡了我眺望的视野，自我使用过N款不同的VPN。往往受到带宽，网速和不定时查水表的困扰，耗时耗钱耗精力，基于种种原因，学习了解VPS相关知识，觉得自己独立租赁个服务器，搭建自己的独立VPN。</li>
</ul>
</blockquote>
<hr>
<ol>
<li>租赁服务器<br>搭建VPN需要网上有详细教程，本文的用以记录个人搭建的经验，方便以后提升逼格。<br>首先需要租赁一个位于国外的服务器，网上可以搜到各种各样的云服务租赁。这里推荐<a href="https://m.do.co/c/b96f567fae48" target="_blank" rel="external">DigitalOcean.</a>,推荐5$一个月的套餐，1TB流量，512M空间（特殊要求除外）。</li>
<li><p>通过控制台进入刚刚建立的Ubuntu,一次执行以下命令，绑定自己的邮箱，生成josn文件，为搭建vpn做准备：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">apt-get update</div><div class="line">sudo apt-get update</div><div class="line">apt-get install python-pip</div><div class="line">pip install shadowsocks</div></pre></td></tr></table></figure>
</li>
<li><p>修改josn数据，cd到根目录 cd touch /etc/shadowsocks.json ，修改josn数据如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</div><div class="line">    <span class="string">"server_port"</span>:XXX,</div><div class="line">    <span class="string">"local_port"</span>:<span class="number">1080</span>,</div><div class="line">    <span class="string">"password"</span>:<span class="string">"XXXXXX"</span>,</div><div class="line">    <span class="string">"timeout"</span>:<span class="number">600</span>,</div><div class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>查看编辑内容cat /etc/shadowsocks.json， 确认无问题运行该段代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssserver -c /etc/shadowsocks.json -d start</div></pre></td></tr></table></figure>
</li>
<li><p>查看绑定邮箱，可以HIGH了。</p>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-国控34报表" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/国控34报表/" class="article-date">
  	<time datetime="2016-08-29T08:34:49.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/国控34报表/">国控34报表</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="34号报表-2016-03-07"><a href="#34号报表-2016-03-07" class="headerlink" title="34号报表 (2016/03/07)"></a>34号报表 (2016/03/07)</h1><p>10.1.    执行步骤：<br>（1）.34号报表每个月月初快照生成后手动刷新，依照下面sql一次执行，每次执行查看相应的8个JOB，JOB运行成功后执行下一步，完成后反馈。<br>–查询job，用来job是否生成成功<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM all_jobs j</div><div class="line"> ORDER BY j.job DESC;</div><div class="line">SELECT *</div><div class="line">  FROM dba_jobs_running;</div><div class="line"></div><div class="line">--STEP1执行脚本，输入前一月</div><div class="line">DECLARE</div><div class="line">  result1 BOOLEAN;</div><div class="line">  result3 BOOLEAN;</div><div class="line">BEGIN</div><div class="line">  --STEP1:数据准备</div><div class="line">  --p_refresh_month: 要刷新的期间</div><div class="line">  result1 := cmx     _refresh_34_pkg.job(p_refresh_month =&gt; <span class="string">'&amp;p_refresh_month'</span>);</div><div class="line">  --STEP3：库存成本数据执行脚本</div><div class="line">  result3 := cmx_034_inv_cost_update_pkg.job(p_refresh_month =&gt; <span class="string">'&amp;p_refresh_month'</span>);</div><div class="line">END;</div><div class="line"></div><div class="line">--STEP2:数据准备</div><div class="line">DECLARE</div><div class="line">  result2 BOOLEAN;</div><div class="line">BEGIN</div><div class="line">  result2 := cmx_oper_purchase_balance_pkg.job;</div><div class="line">END;</div><div class="line">--STEP3：检查STEP2的JOB是否已完成</div><div class="line">SELECT *</div><div class="line">  FROM (SELECT COUNT(*) a</div><div class="line">          FROM cmx_payment_apply_tbl_34mth</div><div class="line">         WHERE <span class="number">1</span> = <span class="number">1</span></div><div class="line">           AND receive_amt IS NOT NULL) job_done,</div><div class="line">       </div><div class="line">       (SELECT COUNT(*) b</div><div class="line">          FROM cmx_payment_apply_tbl_34mth) all_date;</div><div class="line"></div><div class="line">--STEP4:若STEP3中的a=b，则代表JOB已完成，刷新<span class="number">34</span>号&amp;<span class="number">34</span>hd报表</div><div class="line">DECLARE</div><div class="line">  l_tran_month VARCHAR2(<span class="number">30</span>) := <span class="string">'&amp;tran_month'</span>; --交易年月（如<span class="number">2013</span><span class="number">-09</span>）</div><div class="line">  RESULT       BOOLEAN;</div><div class="line">  CURSOR csr_s IS</div><div class="line">    SELECT tbl.receive_amt,</div><div class="line">           tbl.out_amt,</div><div class="line">           tbl.store_sc_amt,</div><div class="line">           tbl.store_sc_amt2,</div><div class="line">           tbl.store_sc_bmt2,</div><div class="line">           tbl.store_sc_bmt,</div><div class="line">           tbl.wholesale_amt,</div><div class="line">           tbl.org_unit_id,</div><div class="line">           tbl.supplier</div><div class="line">      FROM rms.cmx_payment_apply_tbl_34mth tbl</div><div class="line">     WHERE tbl.tran_month = l_tran_month;</div><div class="line">BEGIN</div><div class="line">  FOR rec_s IN csr_s</div><div class="line">  LOOP</div><div class="line">    UPDATE cmx_payment_apply_tbl t</div><div class="line">       SET t.receive_amt   = rec_s.receive_amt,</div><div class="line">           t.out_amt       = rec_s.out_amt,</div><div class="line">           t.store_sc_amt  = rec_s.store_sc_amt,</div><div class="line">           t.store_sc_amt2 = rec_s.store_sc_amt2,</div><div class="line">           t.wholesale_amt = rec_s.wholesale_amt,</div><div class="line">           t.store_sc_bmt2 = rec_s.store_sc_bmt2,</div><div class="line">           t.store_sc_bmt  = rec_s.store_sc_bmt</div><div class="line">     WHERE t.org_unit_id = rec_s.org_unit_id</div><div class="line">       AND t.supplier = rec_s.supplier</div><div class="line">       AND t.tran_month = l_tran_month;</div><div class="line">  END LOOP;</div><div class="line">  COMMIT;</div><div class="line">  --刷新<span class="number">34</span>hd报表</div><div class="line">  RESULT := cmx_purchase_yiji_pkg.job2(<span class="string">'&amp;tran_month'</span>);</div><div class="line">END;</div><div class="line"></div><div class="line">--STEP5.更新库存金额</div><div class="line">DECLARE</div><div class="line">  CURSOR csr_data IS</div><div class="line">    SELECT *</div><div class="line">      FROM cmx_payment_apply_tbl_yiji0828 t</div><div class="line">     WHERE t.tran_month = <span class="string">'&amp;tran_month'</span>;</div><div class="line">BEGIN</div><div class="line">  FOR rec IN csr_data</div><div class="line">  LOOP</div><div class="line">    UPDATE cmx_payment_apply_tbl_yiji t</div><div class="line">       SET t.wh_ohc_amt            = rec.wh_ohc_amt,</div><div class="line">           t.wh_ohc_amt_v          = rec.wh_ohc_amt_v,</div><div class="line">           t.store_cost_amt        = rec.store_cost_amt,</div><div class="line">           t.store_cost_amt_vat    = rec.store_cost_amt_vat,</div><div class="line">           t.store_jm_cost_amt     = rec.store_jm_cost_amt,</div><div class="line">           t.store_jm_cost_amt_vat = rec.store_jm_cost_amt_vat,</div><div class="line">           t.all_ohc_amt           = rec.all_ohc_amt,</div><div class="line">           t.all_ohc_amt_v         = rec.all_ohc_amt_v,</div><div class="line">           t.trans_date            = SYSDATE</div><div class="line">     WHERE t.supplier = rec.supplier</div><div class="line">       AND t.tran_month = <span class="string">'&amp;tran_month'</span>;</div><div class="line">  END LOOP;</div><div class="line">END;</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-create-table" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/create-table/" class="article-date">
  	<time datetime="2016-08-29T08:33:32.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/create-table/">create table</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="建表知识点-2016-03-07"><a href="#建表知识点-2016-03-07" class="headerlink" title="建表知识点 (2016/03/07)"></a>建表知识点 (2016/03/07)</h1><p>9.1.    注意点：<br>（1）.所有表，包，序列，视图都需要建立同义词，理由参考java外部类。<br>–包的同义词<br>–表是健在cmx下的，需要在rms下为其建立一个同义词，这样，rms用户可以查询到你的表了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">create <span class="keyword">or</span> replace synonym    rms.表  <span class="keyword">for</span>  cmx.表</div><div class="line">create <span class="keyword">or</span> replace public synonym cmx_store_item_sku For CMX.cmx_store_item_sku;</div><div class="line">--表的同义词</div><div class="line">create public synonym cmx_inv_adj_temp <span class="keyword">for</span> rms.cmx_inv_adj_temp;</div></pre></td></tr></table></figure></p>
<p>（2）.建表三个步骤（表，同义词，序列）</p>
<h3 id="建表（临时表temporary）"><a href="#建表（临时表temporary）" class="headerlink" title="建表（临时表temporary）"></a>建表（临时表temporary）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">create <span class="keyword">global</span> temporary table CMX.CMX_CHG_ITEM_LOC_QTY_TMP</div><div class="line">(</div><div class="line">  group_id      NUMBER,</div><div class="line">  REF_SOURCE    VARCHAR2(<span class="number">120</span>),</div><div class="line">  REF_NO        VARCHAR2(<span class="number">60</span>),</div><div class="line">  line_no       NUMBER,</div><div class="line">  TSF_NO        NUMBER,</div><div class="line">  item          VARCHAR2(<span class="number">2000</span>) <span class="keyword">not</span> null,</div><div class="line">  loc           NUMBER <span class="keyword">not</span> null,</div><div class="line">  lot           VARCHAR2(<span class="number">2000</span>),</div><div class="line">  INV_STATUS    NUMBER,</div><div class="line">  RESERVED_QTY  NUMBER</div><div class="line">)</div><div class="line">on commit preserve rows;</div><div class="line">--同义词</div><div class="line">create <span class="keyword">or</span> replace public synonym CMX_CHG_ITEM_LOC_QTY_TMP  <span class="keyword">for</span> CMX.CMX_CHG_ITEM_LOC_QTY_TMP;</div><div class="line">-- 建立序列</div><div class="line">create sequence CMX_CHG_ITEM_LOC_QTY_TMP_S</div><div class="line">minvalue <span class="number">1</span></div><div class="line">maxvalue <span class="number">999999999999999999999999999</span></div><div class="line">start <span class="keyword">with</span> <span class="number">10241</span></div><div class="line">increment by <span class="number">1</span></div><div class="line">cache <span class="number">20</span>;</div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-国控接口监控" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/国控接口监控/" class="article-date">
  	<time datetime="2016-08-29T08:32:20.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/国控接口监控/">国控接口监控</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#国控国大接口数据实时报表(2016/02/29)</p>
<p>8.1.    操作步骤：<br>          主要查看MOM传EBS财务数据，登录正是环境下BIP，选择报表EBS_INT_RESULT，选择excel导出接口数据，查询频率为每日，<br>查看正式表数据为0的数据查看结果，如果数据存在临时表，或者接口表中中，抛出问题，提交财务解决，如果三张表数据为空。<br>（1）.如果接口类型是AR类型：输入对应的批名，依次执行以下sql，查看对应的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-<span class="number">-0.</span>收集批处理状态</div><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.analyse_ar_batch;</div><div class="line">END;</div></pre></td></tr></table></figure>
<p>–1.ar事务处理<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM cmx_arifsa_history h</div><div class="line"> WHERE <span class="number">1</span> = <span class="number">1</span></div><div class="line">      /*AND h.store = <span class="number">101812</span></div><div class="line">      AND h.day = <span class="number">17</span></div><div class="line">      AND h.store_day_seq_no = <span class="number">32029536</span></div><div class="line">      AND h.tran_type = <span class="string">'DCLOSE'</span>*/</div><div class="line">   AND h.group_name LIKE <span class="string">'MOMR1086_20160302001%'</span></div><div class="line">   AND h.error_flag = <span class="string">'E'</span>;</div></pre></td></tr></table></figure></p>
<p>–2.查找所有的批处理状态<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM cmx_ar_batch_monitor t</div><div class="line"> WHERE t.org_code = <span class="number">1079</span>;</div><div class="line">--将想要单独处理的批次使用<span class="number">10</span>以外的序列更新进去</div><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.update_ar_process_seq(<span class="string">'MOMR1086_20160302001'</span>,</div><div class="line">                                                  <span class="number">12</span>);</div><div class="line">END;</div><div class="line"></div><div class="line">UPDATE cmx_ar_batch_monitor t</div><div class="line">   SET t.process_seq = <span class="number">22</span></div><div class="line"> WHERE t.org_code = <span class="number">1079</span></div><div class="line">      --AND t.process_type = <span class="string">'R'</span></div><div class="line">   AND t.group_name NOT IN (<span class="string">'MOMR1079_20150811001'</span>);</div><div class="line">```  </div><div class="line">-<span class="number">-3.</span>调用程序处理批处理</div><div class="line">```python</div><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.process_ar_batch(<span class="number">12</span>);</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>–4.查看处理结果<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM cmx_ar_batch_monitor t</div><div class="line"> WHERE t.group_name = <span class="string">'MOMW1065_201507150030715IC00'</span>;</div><div class="line">--</div><div class="line">SELECT *</div><div class="line">  FROM cmx_ar_batch_monitor t</div><div class="line"> WHERE t.process_seq = <span class="number">20</span>;</div><div class="line"></div><div class="line">UPDATE cmx_ar_batch_monitor t</div><div class="line">   SET t.process_seq = <span class="number">15</span></div><div class="line"> WHERE t.stage1_cnt = <span class="number">0</span>;</div></pre></td></tr></table></figure></p>
<p>（2）. 如果接口类型是ap类型，对应相对的批号和ou，依次执行以下sql查看相应的结果。<br>–0.收集批处理状态<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.analyse_ap_batch;</div><div class="line">END;</div><div class="line"></div><div class="line">-<span class="number">-1.</span>查找所有的批处理状态</div><div class="line">SELECT *</div><div class="line">  FROM cmx_ap_batch_monitor t</div><div class="line"> WHERE t.org_code IN (<span class="number">1065</span>);</div><div class="line">SELECT *</div><div class="line">  FROM cmx_ap_batch_monitor t</div><div class="line"> WHERE t.stage1_cnt = <span class="number">0</span></div><div class="line">   AND t.trx_line_cnt = <span class="number">0</span>;</div><div class="line"></div><div class="line">UPDATE cmx_ap_batch_monitor t</div><div class="line">   SET t.process_seq = <span class="number">15</span></div><div class="line"> WHERE t.stage1_cnt = <span class="number">0</span></div><div class="line">   AND t.trx_line_cnt = <span class="number">0</span>;</div><div class="line">SELECT *</div><div class="line">  FROM cmx_arif_ebs_history h</div><div class="line"> WHERE h.group_name = <span class="string">'MOMW1092_201506240010623WR00'</span>;</div></pre></td></tr></table></figure></p>
<p>–将想要单独处理的批次使用10以外的序列更新进去<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.update_ap_process_seq</div><div class="line">(<span class="string">'1090_PD0036_NEWREIM_AP20160216090035'</span>, <span class="number">35</span>);</div><div class="line">END;</div><div class="line"></div><div class="line">UPDATE cmx_ap_batch_monitor t</div><div class="line">   SET t.process_seq = <span class="number">25</span></div><div class="line"> WHERE t.trx_line_cnt = <span class="number">0</span>;</div><div class="line"></div><div class="line">UPDATE cmx_ap_batch_monitor t</div><div class="line">   SET t.process_seq = <span class="number">35</span></div><div class="line"> WHERE t.org_code = <span class="number">1065</span></div><div class="line">   AND t.process_type = <span class="string">'R'</span></div><div class="line">   AND t.group_name IN (<span class="string">'MOMR1092_20150618001'</span>,</div><div class="line">                        <span class="string">'MOMR1092_20150617001'</span>,</div><div class="line">                        <span class="string">'MOMR1092_20150619001'</span>);</div></pre></td></tr></table></figure></p>
<p>–2.调用程序处理批处理<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.process_ap_batch(<span class="number">35</span>);</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>–3.查看处理结果<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM cmx_ap_batch_monitor t</div><div class="line"> WHERE t.group_name = <span class="string">'MOMR1092_20150612001'</span>;</div><div class="line">--</div></pre></td></tr></table></figure></p>
<p>（3）. 如果接口类型是gl类型，对应相对的批号和ou，依次执行以下sql查看相应的结果。<br>–0.收集批处理状态<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.analyse_gl_batch;</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>–1.查找所有的批处理状态<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM cmx_gl_batch_monitor t</div><div class="line"> WHERE t.org_code = <span class="number">1087</span>;</div></pre></td></tr></table></figure></p>
<p>–将想要单独处理的批次使用10以外的序列更新进去<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.update_gl_process_seq</div><div class="line">(<span class="string">'2105_20151130_GL20151202072505'</span>, <span class="number">15</span>);</div><div class="line">END;</div><div class="line"></div><div class="line">UPDATE cmx_gl_batch_monitor t</div><div class="line">   SET t.process_seq = <span class="number">16</span></div><div class="line"> WHERE t.org_code = <span class="number">1087</span></div><div class="line">      --   AND t.process_type = <span class="string">'R'</span></div><div class="line">   AND t.group_name IN (<span class="string">'1087_20150818_GL20150821065423'</span>);</div></pre></td></tr></table></figure></p>
<p>–2.调用程序处理批处理<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  cmx_int_batch_monitor_pkg.process_gl_batch(<span class="number">15</span>);</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>–3.查看处理结果<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM cmx_gl_batch_monitor t</div><div class="line"> WHERE t.group_name = <span class="string">'MOMR1092_20150612001'</span>;</div><div class="line">每月月初查看未开区间</div><div class="line">SELECT u.attribute1,</div><div class="line">       hou.name,</div><div class="line">       le.name,</div><div class="line">       decode(s.application_id,</div><div class="line">              <span class="number">101</span>,</div><div class="line">              <span class="string">'总账'</span>,</div><div class="line">              <span class="number">200</span>,</div><div class="line">              <span class="string">'应付'</span>,</div><div class="line">              <span class="number">222</span>,</div><div class="line">              <span class="string">'应收'</span>) 应用,</div><div class="line">       fl.meaning,</div><div class="line">       s.*</div><div class="line">  FROM gl_period_statuses    s,</div><div class="line">       gl_ledgers            le,</div><div class="line">       fnd_lookups           fl,</div><div class="line">       hr_operating_units    hou,</div><div class="line">       hr_organization_units u</div><div class="line"> WHERE s.start_date = trunc(SYSDATE,</div><div class="line">                            <span class="string">'mm'</span>)</div><div class="line">   AND s.application_id IN (<span class="number">101</span>,</div><div class="line">                            <span class="number">200</span>,</div><div class="line">                            <span class="number">222</span>)</div><div class="line">   AND le.ledger_id = s.set_of_books_id</div><div class="line">   AND le.name LIKE <span class="string">'R%'</span></div><div class="line">   AND instr(le.name,</div><div class="line">             <span class="string">'CON'</span>) = <span class="number">0</span></div><div class="line">   AND fl.lookup_type = <span class="string">'OKL_PERIOD_STATUS'</span></div><div class="line">   AND fl.lookup_code = s.closing_status</div><div class="line">   AND s.closing_status &lt;&gt; <span class="string">'O'</span></div><div class="line">   AND hou.set_of_books_id = le.ledger_id</div><div class="line">   AND u.organization_id = hou.organization_id</div><div class="line">   AND u.attribute1 IS NOT NULL</div><div class="line"> ORDER BY le.ledger_id;</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Oracle-FROM-开发注意" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/Oracle-FROM-开发注意/" class="article-date">
  	<time datetime="2016-08-29T08:30:30.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/Oracle-FROM-开发注意/">Oracle FROM 开发注意</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#FORM开发总结(2015/11/20)</p>
<p>6.1.    Form开发知识总结<br>6.1.1.    相关记录<br>Form开发知识点记录，参考form：NAV-&gt;申请单-&gt;库存转移。参考form：cmx_transaction.fmb。参考包：cmx_transaction_wh_pkg.pck。</p>
<ol>
<li><p>form保留固定的小数位数。<br>| 原数字| Format mask|结果|说明|<br>| ——– | | ——–   | | ——–   | | ——–   |<br>|123456.03 |FM999，990|FM999，990.00 ||<br>|0.123|    FM999,999.00|    .12    |小数点前是9|<br>|0.123|    FM999,990.00|    0.12|    小数点前是0|<br>|123456789.03|    FM999,990.00|    ######    |因为Format Mask的个数不够<br>|123456789.03|    FM999,999,990.00|    123,456,789.03    ||<br>在to_char中to_char(A,B)：<br>|A    |B    |结果    |说明|<br>| ——– | | ——–   | | ——–   | | ——–   |<br>|0.123|    FM999,999.00|    .123|    小数点前是9|<br>|0.123|    FM999,990.00|    0.123|    小数点前是0|</p>
</li>
<li><p>Oracle Form系统变量。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>变量名</th>
<th>变量表述</th>
</tr>
</thead>
<tbody>
<tr>
<td>system.block_status</td>
<td>包含了当前块的状态，可有三个值：CHANGED，表明块中至少有一个记录被修改过；NEW，表明块中仅有未被修改过的记录；QUERY，表明块处于查询模式中。</td>
</tr>
<tr>
<td>system.current_block</td>
<td>决定输入点的位置，当它出现在块、记录、项中时，它的值是块名。当pre_，post_form类触发器启动时，它的值为空（null）。</td>
</tr>
<tr>
<td>system.current_datetime</td>
<td>包含当前操作系统的日期和时间的字符值，默认格式为DD_MON_YYYY  HH24:MI:SS</td>
</tr>
<tr>
<td>system.cursor_block</td>
<td>包含当前光标所停留的块的名字。</td>
</tr>
<tr>
<td>system.cursor_item</td>
<td>包含当前光标所停留的块和项的名字。</td>
</tr>
<tr>
<td>system.form_status</td>
<td>包含含有光标的form的状态。其值可为以下一个或多个：CHANGED，NEW，QUERY。</td>
</tr>
<tr>
<td>system.last_record</td>
<td>包含一个在记录块集中表示当前记录是否是最后记录的布尔值</td>
</tr>
<tr>
<td>system.record_status</td>
<td>包含了鼠标所在位置的记录状态，其值为CHANGED、INSERT、NEW和QUERY。</td>
</tr>
<tr>
<td>system.trigger_block</td>
<td>包含了在当前触发器启动时鼠标所在块的名字。</td>
</tr>
<tr>
<td>system.trigger_item</td>
<td>包含了在当前触发器启动时鼠标所在块和项的名字。</td>
</tr>
<tr>
<td>system.trigger_record</td>
<td></td>
<td></td>
<td>包含了Form正在处理的记录个数。</td>
</tr>
</tbody>
</table>
<hr>
<ol>
<li>Oracle form传参调用另外的form。<br> Form 调用另一个form的意思就是说，我要在form A中触发某个事件，然后调用到form B，而这又不是单纯的只是显示出form B，而要传递A中的某些参数以供form B的使用，或者说form B的执行需要form A中的某些参数。对于这个问题，在form中可以通过定义参数列、清空form A参数列、初始化form A参数列、添加参数到参数列、使用open_form打开form B并调用参数列。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">DECLARE</div><div class="line">  -- 定义参数列</div><div class="line">  l_pl_id paramlist;</div><div class="line">BEGIN</div><div class="line">  -- 清空form_A的参数列</div><div class="line">  p_destroy_parameter_list(<span class="string">'form_A'</span>);</div><div class="line">  -- 初始化form_A的参数列</div><div class="line">  l_pl_id := create_parameter_list(<span class="string">'form_A'</span>);</div><div class="line">  -- 添加参数PM_STORE到参数列，并赋值，注意赋值的类型主要有text_parameter、data_parameter两种，text_parameter代表字符串型，而data_parameter并不是代表数值，详细参加参考文档add_parameter。</div><div class="line"></div><div class="line">  add_parameter(l_pl_id,</div><div class="line">                <span class="string">'PM_STORE'</span>,</div><div class="line">                text_parameter,</div><div class="line">                :b_order_head.store);</div><div class="line">  -- 添加参数PM_ITEM到参数列，并赋值，注意赋值的类型主要有text_parameter、data_parameter两种，text_parameter代表字符串型，而data_parameter并不是代表数值，详细参加参考文档add_parameter。</div><div class="line">  add_parameter(l_pl_id,</div><div class="line">                <span class="string">'PM_ITEM'</span>,</div><div class="line">                text_parameter,</div><div class="line">                :b_order_detail.item);</div><div class="line">  -- 添加参数PM_ITEM_DESC到参数列，并赋值，注意赋值的类型主要有text_parameter、data_parameter两种，text_parameter代表字符串型，而data_parameter并不是代表数值，详细参加参考文档add_parameter。</div><div class="line">  add_parameter(l_pl_id,</div><div class="line">                <span class="string">'PM_ITEM_DESC'</span>,</div><div class="line">                text_parameter,</div><div class="line">                :b_order_detail.ti_item_desc);</div><div class="line"> </div><div class="line">  -- 使用open_form打开form_B并调用参数列</div><div class="line">  open_form(<span class="string">'form_B'</span>,</div><div class="line">            activate,</div><div class="line">            session,</div><div class="line">            l_pl_id);</div><div class="line">  -- 异常处理</div><div class="line">EXCEPTION</div><div class="line">  WHEN form_trigger_failure THEN</div><div class="line">    RAISE;</div><div class="line">  WHEN OTHERS THEN</div><div class="line">    emessage(SQLERRM);</div><div class="line">    RAISE form_trigger_failure;</div><div class="line">END;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这里往参数列中添加了的PM_STORE、PM_ITEM、PM_ITEM_DESC这几个参数，在form_A、form_B中都应该是已经定义了的。</p>
<p>4.form where查询案例：<br>添加时间和固定数据库项搜索。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">PACKAGE BODY p_find IS</div><div class="line">  PROCEDURE pb_search IS</div><div class="line">  </div><div class="line">    l_transaction_no   NUMBER := :b_find.transaction_no;</div><div class="line">    l_transaction_type VARCHAR2(<span class="number">20</span>) := :b_find.transaction_type;</div><div class="line">    l_from_loc         NUMBER := :b_find.from_loc;</div><div class="line">    l_to_loc           NUMBER := :b_find.to_loc;</div><div class="line">    l_pos_no           NUMBER := :b_find.pos_no;</div><div class="line">    ---</div><div class="line">    l_text VARCHAR2(<span class="number">2400</span>) := <span class="string">'WHERE 1 = 1'</span>;</div><div class="line">  </div><div class="line">  BEGIN</div><div class="line">  </div><div class="line">    IF :b_find.li_action = <span class="string">'EDIT'</span></div><div class="line">       AND :b_find.transaction_type = <span class="string">'Y'</span> THEN</div><div class="line">      emessage(<span class="string">'云药店退货单据类型，无法被编辑，请使用查看功能'</span>);</div><div class="line">      RAISE form_trigger_failure;</div><div class="line">    ELSE</div><div class="line">    </div><div class="line">      go_block(<span class="string">'B_FIND_ANS'</span>);</div><div class="line">      show_window(<span class="string">'W_FIND_MAIN'</span>);</div><div class="line">      ---</div><div class="line">      IF l_transaction_no IS NOT NULL THEN</div><div class="line">        l_text := l_text || <span class="string">' and TRANSACTION_NO = '</span> || l_transaction_no;</div><div class="line">      END IF;</div><div class="line">      ---</div><div class="line">      IF l_transaction_type IS NOT NULL THEN</div><div class="line">        l_text := l_text || <span class="string">' and TRANSACTION_TYPE = '</span><span class="string">''</span> || l_transaction_type || <span class="string">'''';</span></div><div class="line">      END IF;</div><div class="line">--where子句例子</div><div class="line">      IF l_pos_no IS NOT NULL THEN</div><div class="line">        l_text := l_text || ' and POS_NO = ''' || l_pos_no || <span class="string">'''';</span></div><div class="line">      END IF;</div><div class="line">      ---</div><div class="line">      IF l_from_loc IS NOT NULL THEN</div><div class="line">        l_text := l_text || ' and FROM_LOC = ''' || l_from_loc || <span class="string">'''';</span></div><div class="line">      END IF;</div><div class="line">      --</div><div class="line">      IF l_to_loc IS NOT NULL THEN</div><div class="line">        l_text := l_text || ' and TO_LOC = ''' || l_to_loc || <span class="string">'''';</span></div><div class="line">      END IF;</div><div class="line">      IF :b_find.ti_create_f IS NOT NULL</div><div class="line">         OR :b_find.ti_create_t IS NOT NULL THEN</div><div class="line">        l_text := l_text || ' and trunc(create_date) &gt;= ' || ' NVL(to_date(''' || to_char(:b_find.ti_create_f) ||</div><div class="line">                  <span class="string">''', ''DD-MON-RR''), trunc(create_date)) ' || ' and ' || 'trunc(create_date) &lt;= ' || ' NVL(to_date('''</span> ||</div><div class="line">                  to_char(:b_find.ti_create_t) || <span class="string">''', ''DD-MON-RR''), trunc(create_date))';</span></div><div class="line">      END IF;</div><div class="line">      IF :b_find.ti_approve_f IS NOT NULL</div><div class="line">         OR :b_find.ti_approve_t IS NOT NULL THEN</div><div class="line">        l_text := l_text || ' and trunc(approve_date) &gt;= ' || ' NVL(to_date(''' || to_char(:b_find.ti_approve_f) ||</div><div class="line">                  <span class="string">''', ''DD-MON-RR''), trunc(approve_date)) ' || ' and ' || 'trunc(approve_date) &lt;= ' || ' NVL(to_date('''</span> ||</div><div class="line">                  to_char(:b_find.ti_approve_t) || <span class="string">''', ''DD-MON-RR''), trunc(approve_date))';</span></div><div class="line">      END IF;</div><div class="line">    --where查询</div><div class="line">      set_block_property('B_FIND_ANS',</div><div class="line">                         default_where,</div><div class="line">                         l_text);</div><div class="line">      ---</div><div class="line">    </div><div class="line">      execute_query;</div><div class="line">    </div><div class="line">    END IF;</div><div class="line">  EXCEPTION</div><div class="line">    WHEN form_trigger_failure THEN</div><div class="line">      RAISE;</div><div class="line">    WHEN OTHERS THEN</div><div class="line">      emessage(SQLERRM);</div><div class="line">      RAISE form_trigger_failure;</div><div class="line">  END;</div></pre></td></tr></table></figure></p>
<ol>
<li>关闭菜单栏和开启菜单栏：<br>set_menu_item_property(‘options_menu.PO_APPROVE’,<pre><code>enabled,
property_false);
</code></pre>set_menu_item_property(‘options_menu.DELETE’,<pre><code>enabled,
property_true);
</code></pre></li>
<li>关闭form触发器参考：<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">DECLARE</div><div class="line">  l_save_form BOOLEAN;</div><div class="line">BEGIN</div><div class="line">  IF NOT window_handler.wwc_is_system_window THEN</div><div class="line">    validate(item_scope);</div><div class="line">    ---------------------------------------------------------</div><div class="line">    --- The following <span class="keyword">if</span> statement should only be uncommented</div><div class="line">    --- <span class="keyword">if</span> users have multiple windows <span class="keyword">in</span> their form</div><div class="line">    ---------------------------------------------------------</div><div class="line">    ---   <span class="keyword">if</span> :system.event_window = <span class="string">'W_PRIMARY_WINDOW'</span> then</div><div class="line">    --- This function calls upon the window handler function to close the form.</div><div class="line">    --- If the :system.form_status <span class="keyword">is</span> changed it will prompt the user to save their</div><div class="line">    --- changes, otherwise it will exit the form.</div><div class="line">  </div><div class="line">    ---</div><div class="line">    IF :system.event_window = <span class="string">'W_FIND'</span> THEN</div><div class="line">      --emessage(:system.event_window);</div><div class="line">      exit_form(no_validate);</div><div class="line">    ELSIF :system.event_window = <span class="string">'W_FIND_MAIN'</span> THEN</div><div class="line">      --emessage(:system.event_window); </div><div class="line">      go_block(<span class="string">'B_FIND'</span>);</div><div class="line">      go_item(<span class="string">'B_FIND.LI_action'</span>);</div><div class="line">      hide_window(<span class="string">'W_FIND_MAIN'</span>);</div><div class="line">    ELSIF :system.event_window = <span class="string">'W_MAIN'</span> THEN</div><div class="line">      --emessage(:system.event_window);</div><div class="line">      set_menu_item_property(<span class="string">'options_menu.DELETE'</span>,</div><div class="line">                             enabled,</div><div class="line">                             property_false);</div><div class="line">      set_menu_item_property(<span class="string">'options_menu.PO_APPROVE'</span>,</div><div class="line">                             enabled,</div><div class="line">                             property_false);</div><div class="line">      l_save_form := window_handler.wwc_save_changes;</div><div class="line">      IF :system.form_status &lt;&gt; <span class="string">'QUERY'</span> THEN</div><div class="line">        IF l_save_form = TRUE THEN</div><div class="line">          commit_form;</div><div class="line">        ELSIF l_save_form = FALSE THEN</div><div class="line">          p_exit.cancel_form;</div><div class="line">        ELSIF l_save_form IS NULL THEN</div><div class="line">          NULL;</div><div class="line">        END IF;</div><div class="line">      END IF;</div><div class="line">      IF :b_find.li_action = <span class="string">'NEW'</span> THEN</div><div class="line">        hide_window(<span class="string">'W_MAIN'</span>);</div><div class="line">        go_block(<span class="string">'B_FIND'</span>);</div><div class="line">      ELSE</div><div class="line">        go_block(<span class="string">'B_FIND_ANS'</span>);</div><div class="line">        hide_window(<span class="string">'W_MAIN'</span>);</div><div class="line">      END IF;</div><div class="line">    END IF;</div><div class="line">    ---   elsif :system.event_window = <span class="string">'W_SECONDARY_WINDOW'</span> then</div><div class="line">    ---   do secondary window close logic</div><div class="line">    ---   end <span class="keyword">if</span>;</div><div class="line">  END IF;</div><div class="line">EXCEPTION</div><div class="line">  WHEN form_trigger_failure THEN</div><div class="line">    RAISE;</div><div class="line">  WHEN OTHERS THEN</div><div class="line">    emessage(SQLERRM);</div><div class="line">    RAISE form_trigger_failure;</div><div class="line">END;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>7.光标选择单行。</p>
<p>8.显示系统时间：<br>   :B_TRANSACTION_head.CREATE_DATE := SYSDATE;<br>9.时间显示精确到时分秒，格式设置</p>
<ol>
<li>时间选择框现在格式（2015-10-21）：<br>Item触发器显示：<br>WHEN-NEW-ITEM-INSTANCE：<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  IF (p_calendar.lp_date_ok IS NOT NULL) THEN</div><div class="line">    IF (p_calendar.lp_date_ok = <span class="string">'Y'</span>) THEN</div><div class="line">      :b_find.ti_create_t   := p_calendar.lp_current_date;</div><div class="line">      p_calendar.lp_date_ok := NULL;</div><div class="line">    ELSE</div><div class="line">      p_calendar.lp_date_ok := NULL;</div><div class="line">    END IF;</div><div class="line">  END IF;</div><div class="line">END;</div><div class="line">	KEY-LISTVAL：</div><div class="line">DECLARE</div><div class="line">  l_return_to    VARCHAR2(<span class="number">256</span>) := <span class="string">'B_FIND.TI_CREATE_T'</span>;</div><div class="line">  l_default_date DATE := NULL;</div><div class="line">  l_min_date     DATE := NULL;</div><div class="line">  l_max_date     DATE := NULL;</div><div class="line"></div><div class="line">BEGIN</div><div class="line"></div><div class="line">  p_calendar.show_calendar(l_return_to    =&gt; l_return_to,</div><div class="line">                           l_default_date =&gt; l_default_date,</div><div class="line">                           l_min_date     =&gt; l_min_date,</div><div class="line">                           l_max_date     =&gt; l_max_date);</div><div class="line">END; </div><div class="line">PRE-TEXT-ITEM：</div><div class="line">Null;</div><div class="line">POST-TEXT-ITEM</div><div class="line">Null;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>Item属性设置</p>
<p> 11 .提交去除验证：<br>oraclefunction<br>在form中进行保存时，如果使用commit_form的话会弹出信息提示“没有修改需要保存”或者“几条记录已保存”类似的字样，有时候不想被提示，可以使用APPCORE.pll中的app_form程序包中的quietcommit这个function，由于是一个function，所以需要定义一个变量用来接收返回值，返回值类型为boolean，当true的时候就说明成功，否则commit失败！</p>
<p>或者调用一下过程（将系统的消息级别更改为较低级别）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">PROCEDURE DOCOMMIT IS </div><div class="line">  old_level VARCHAR2(<span class="number">2</span>); </div><div class="line">BEGIN </div><div class="line">  old_level := NAME_IN(<span class="string">'system.message_level'</span>); </div><div class="line">  COPY(<span class="string">'5'</span>,<span class="string">'system.message_level'</span>); </div><div class="line">  commit; </div><div class="line">  COPY(old_level,<span class="string">'system.message_level'</span>); </div><div class="line">END；</div></pre></td></tr></table></figure>
<p>12.关闭无验证：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Exit_Form(No_Validate);</div></pre></td></tr></table></figure></p>
<p>13.动态生成下拉框：<br>假设数据库TEST_BLOCK，下面有一个TEST_ITEM,类型为列表项，子类信息为LIST.<br>(1).添加元素add_list_element(‘TEST_BLOCK.TEST_ITEM’,I,v_name,v_id);<br>–i对应列表中的第几个项，V_NAME是列表中显示的项，V_ID是项对应的值<br>(2).删除元素<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete_list_element(<span class="string">'TEST_BLOCK.TEST_ITEM'</span>,i);</div></pre></td></tr></table></figure></p>
<p>14.form中常用函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">abort_query	停止查询执行</div><div class="line">add_list_element(list name <span class="keyword">or</span> list id,  list index,list lable,list value);	list name是list的名字,list index 是添加到列表框的索引，list label指定了放入列表中的数值串,list value包含了列表标识所应对的资料库的数值.</div><div class="line">clear_block	清空当前块</div><div class="line">clear_form	清空当前form</div><div class="line">clear_item(name)	清空当前项</div><div class="line">clear_list(name)	清空下拉框选值</div><div class="line">clear_record	清空当前记录</div></pre></td></tr></table></figure></p>
<ol>
<li><p>f_yes_no方法使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">BEGIN</div><div class="line">  IF f_yes_no( <span class="string">'?MANUAL_BT'</span>) THEN </div><div class="line">    set_menu_item_property( <span class="string">'options_menu.DELETE'</span>,</div><div class="line">                           enabled,</div><div class="line">                           property_false);</div><div class="line">    set_menu_item_property( <span class="string">'options_menu.PO_APPROVE'</span>,</div><div class="line">                           enabled,</div><div class="line">                           property_false);</div><div class="line">  END IF;</div><div class="line">END;</div></pre></td></tr></table></figure>
</li>
<li><p>打印报表 (2016/02/29)</p>
</li>
</ol>
<p>7.1.    操作步骤：<br>主要记录在form中如果调用报表，打印相应的数据。参考form（cmx_order）。</p>
<p>–声明传递的form<br>```python<br>p_destroy_parameter_list(‘cmx_order’);<br>pl_id := create_parameter_list(‘cmx_order’);<br>–添加传递的参数</p>
<p>  add_parameter(pl_id,<br>                ‘PM_order_no’,<br>                text_parameter,<br>                to_char(:b_head.order_no));</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-FORM开发步骤" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/FORM开发步骤/" class="article-date">
  	<time datetime="2016-08-29T08:29:01.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/FORM开发步骤/">FORM开发步骤</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#FORM开发步骤(2015/10/22)</p>
<p>5.1.    Form开发步骤规范<br>5.1.1.    相关记录<br>通过标准模板创建form 步骤：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">1、 拷贝cmx_test1.fmb，改名xxx.fmb，打开后把form名也改了，保持一致</div><div class="line">2、 删除标准块BLOCKNAME 、DETAILBLOCK和画布BLOCKNAME</div><div class="line">3、 修改windows下的BLOCKNAME这个window，改属性里的名称xxx和title</div><div class="line">4、 修改forms级触发器 pre_form, app_window.set_window_position('xxxx', 'FIRST_WINDOW');</div><div class="line">5、 修改forms级触发器when_new_form_instance，主要修改form名</div><div class="line">6、 修改program unit 下的app_custom中的close_window过程，if (wnd = 'xxx') then app_window.close_first_window;</div><div class="line">7、 创建数据块，设置item属性，是否可导航，非数据库item设置database item为no，显示在画布physical，prompt设置显示在画布上的属性</div><div class="line">8、 创建画布，一个window必需有且仅有一块主画布，设置画布的子类和放置窗口</div><div class="line">9、 设置form属性，第一个导航块</div><div class="line">10、 调用CUX_PLSQL_AUTOCREATE自动生成4个on触发器</div><div class="line">12、 定义function 应用开发员-&gt;功能</div><div class="line">功能： from名 用户功能名：菜单下可见（CUX_XXX）</div><div class="line">特性：类型选择form</div><div class="line">表单：功能、表单都用form名</div><div class="line">13、 加入到职责</div><div class="line">系统管理员-&gt;责任（通过责任名查出所属菜单名）</div><div class="line">应用产品-&gt;菜单-&gt;用户菜单名（用户可见）-&gt;继续查询子菜单-&gt;添加</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-BIP-development" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/BIP-development/" class="article-date">
  	<time datetime="2016-08-29T08:27:45.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/BIP-development/">BIP development</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="BIP报表相关-2015-10-22"><a href="#BIP报表相关-2015-10-22" class="headerlink" title="BIP报表相关(2015/10/22)"></a>BIP报表相关(2015/10/22)</h2><h2 id="BIP报表记录"><a href="#BIP报表记录" class="headerlink" title="BIP报表记录"></a>BIP报表记录</h2><p>4.1.1.    开发步骤详解<br>记录BIP报表简单开发流程。<br>1.登录BIP系统<br>2.登录后点击报表可查看系统中所有的报表</p>
<p>3.点击进入文件夹，尝试创建新的报表，点击左侧工具栏创建新的报表，并输入报表名字。</p>
<p>4.进入新建立的报表，在报表左侧，分为4块，用于存放报表主体信息的数据模型，LOV列表值得值列表和界面搜索参数的参数列表以及显示界面的布局。<br>5.点击左侧报表选择正确的数据库，添加相应的报表介绍信息，新建一个数据模型，选择数据源后，写入相关的数据查询方法。<br>6新建相应的LOV值列表，在查询框中写入正确的查询方法。<br>7.添加参数用于界面查询，LOV参数栏，选择相应的值列表<br>8.点击布局，自动生成相应的模板文件，下载模板文件，使用BIPublisher编辑相应的界面，将编辑好的文件上传至模板模块。<br>9.保存相应的信息，点击视图查看相应的界面，输入相应的查询条件，点击视图查看报表结果。 </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Form-Development" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/Form-Development/" class="article-date">
  	<time datetime="2016-08-29T08:25:44.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/Form-Development/">Form Development</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="FORM开发相关触发器-2015-09-20"><a href="#FORM开发相关触发器-2015-09-20" class="headerlink" title="FORM开发相关触发器(2015/09/20)"></a>FORM开发相关触发器(2015/09/20)</h2><p>2.1.    FORM主要触发器<br>2.1.1.    常用触发器相关记录<br>记录form开发中常用的触发器相关介绍，已便后期触发器的调用。<br>1.Form触发器执行顺序：<br>打开form时候的出发顺序<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">PRE-FORM，</div><div class="line">PRE-BLOCK(BLOCK级)，</div><div class="line">WHEN-NEW-FORM-INSTANCE，</div><div class="line">WHEN-NEW-BLOCK-INSTANCE，</div><div class="line">WHEN-NEW-RECORD-INSTANCE，</div><div class="line">WHEN-NEW-ITEM-INSTANC。</div></pre></td></tr></table></figure></p>
<p>2.当填写一行记录完成后，光标移动到下一条记录的时候：<br>参考文档（<a href="http://wenku.baidu.com/link?url=v6y-2Lk_Tzy56ZpDq8I3eR8vXno0JNb6tL81-XpkhsuwGZ7oPF3knbfvgpOGMoGa2fdhNwgLs25PhfXW_KkspD0V_CcsrniRKeyeCnYHi5i）" target="_blank" rel="external">http://wenku.baidu.com/link?url=v6y-2Lk_Tzy56ZpDq8I3eR8vXno0JNb6tL81-XpkhsuwGZ7oPF3knbfvgpOGMoGa2fdhNwgLs25PhfXW_KkspD0V_CcsrniRKeyeCnYHi5i）</a><br>WHEN-VALIDATE-RECORD（:SYSTEM.CURSOR_RECORD用来写显示当前记录行状态）。<br>WHEN-NEW-RECORD-INSTANCE，WHEN-NEW-ITEM-INSTANCE。</p>
<p>3.当点击保存时<br>WHEN-VALIDATE-RECORD（将页面上的所有数据提交到数据库，若页面有重复数据，则提交第一次时成功但只是将数据先写到数据库中一类似临时表的地方，在提交第二条重复记录的时候报错，执行事务回滚，原来执行成功的指令也将被撤销）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">POST-INSERT</div><div class="line">KEY-COMMIT</div><div class="line">WHEN-NEW-ITEM-INSTANCE</div></pre></td></tr></table></figure>
<p>4.当光标移动到当前数据块中已经显示的行上<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">WHEN-REMOVE-RECORD（当离开当前记录行）</div><div class="line">WHEN-NEW-RECORD-INSTANCE（当光标输入新的记录行）</div><div class="line">ON-LOCK（当锁定某项并修改时）</div></pre></td></tr></table></figure></p>
<p>5.选中LOV列表<br>WHEN-NEW-ITEM-INSTANCE，KEY-LISTVAL<br>6.FORM切换到当前窗体时<br>WHEN-FORM-NAVIGATE，WHEN-NEW-ITEM-INSTANCE</p>
<hr>
<h2 id="上传下载相关-2015-09-20"><a href="#上传下载相关-2015-09-20" class="headerlink" title="上传下载相关(2015/09/20)"></a>上传下载相关(2015/09/20)</h2><p>3.1.    上传下载知识点归纳<br>3.1.1.    上传操作<br>参考form：cmx_region_adjfind.fmb<br>（1）. 加载对象文件WEBUTIL，OG_VA，OG_STANDARD_NEW，OG_TOOLBAR<br>（2）. 加载库文件WEBUTIL，RMBLIB,STAND45，RP2RRO,ARIIFLIB,MESSGE45。<br>（3）.新建windows，选择Visual Attribute Group：WINDOW。<br>（4）.新建一个上传的画布，用来存放相应的错误信息。（参考upload.fmb）</p>
<p>（5）.界面上添加导出按钮。为按钮添加触发器，连接到update的form。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">WHEN-BUTTON-PRESSED：</div><div class="line">declare</div><div class="line">PL_id      PARAMLIST;</div><div class="line">BEGIN</div><div class="line">P_DESTROY_PARAMETER_LIST(<span class="string">'cmz_region_adjfind'</span>);</div><div class="line"> PL_id := Create_Parameter_List(<span class="string">'cmz_region_adjfind'</span>);</div><div class="line">Add_Parameter(PL_id, <span class="string">'PM_UPLOAD_OBJECT'</span>,  TEXT_PARAMETER,</div><div class="line">                 <span class="string">'REGION_INVADJ'</span>);</div></pre></td></tr></table></figure></p>
<p>– 打开正常维护界面<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Open_Form(<span class="string">'cmx_upload'</span>,</div><div class="line">ACTIVATE,</div><div class="line">SESSION,</div><div class="line">PL_id);</div><div class="line">EXCEPTION</div><div class="line">when FORM_TRIGGER_FAILURE then</div><div class="line"><span class="keyword">raise</span>;</div><div class="line">when OTHERS then</div><div class="line">emessage(SQLERRM);</div><div class="line"><span class="keyword">raise</span> FORM_TRIGGER_FAILURE;</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>（6）.通过Add_Parameter，传递一个参数，调用相应的验证方法。<br>（参考CMX_DATA_IMP_SQL.cmx_region_invadj_sql）。生成单号递增随机数方法：SELECT Cmx_inv_adj_head_S.NEXTVAL INTO L_REQ_NO FROM DUAL。<br>3.1.2.    导出操作<br>参考form：cmx_region_invadj.fmb。<br>（1）. 加载对象文件WEBUTIL，OG_VA，OG_STANDARD_NEW，OG_TOOLBAR<br>（2）. 加载库文件WEBUTIL,RMBLIB,STAND45,RP2RRO,ARIIFLIB,MESSGE45。<br>（3）.新建windows，选择Visual Attribute Group：WINDOW。<br>（4）.新建BLOG 包含导出的几个元素：<br>（5）.导出地址选择器，添加触发器：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">PROCEDURE pb_filepath_pressed IS</div><div class="line">  l_filename VARCHAR2(<span class="number">300</span>);</div><div class="line">BEGIN</div><div class="line">  l_filename := webutil_file.file_save_dialog( --directory_name =&gt; :parameter.user_home,</div><div class="line"> file_name   =&gt; to_char(SYSDATE,  <span class="string">'YYYY-MM-DD'</span>) || <span class="string">'_区域库存调整信息'</span> || <span class="string">'.csv'</span>, file_filter =&gt; NULL, title       =&gt; <span class="string">'请选择要保存的文件名称'</span>);</div><div class="line">copy(l_filename,<span class="string">'b_export.di_filepath'</span>);</div><div class="line">  END pb_filepath_pressed;</div></pre></td></tr></table></figure></p>
<p>6.给导出按钮添加触发器（显示导出文件的格式和显示的格式等）：（注意头和行分开）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">DECLARE</div><div class="line">    --add by hand-zp <span class="number">2015</span><span class="number">-10</span><span class="number">-08</span></div><div class="line">    l_col_head       VARCHAR2(<span class="number">4000</span>);</div><div class="line">    l_col_concat     VARCHAR2(<span class="number">32767</span>);</div><div class="line">    l_sql            VARCHAR2(<span class="number">4000</span>);</div><div class="line">    l_blob           BLOB;</div><div class="line">    l_line_length    NUMBER;</div><div class="line">    l_po_line        VARCHAR2(<span class="number">4000</span>);</div><div class="line">    l_file_id        NUMBER;</div><div class="line">    l_error_msg      VARCHAR2(<span class="number">3000</span>);</div><div class="line">    l_block_name     VARCHAR2(<span class="number">100</span>) := <span class="string">'B_INV_ADJ_DETAIL'</span>;</div><div class="line">    l_form_name      VARCHAR2(<span class="number">100</span>) := <span class="string">'FM_CMX_REGION_INVADJ'</span>;</div><div class="line">    l_row            NUMBER := <span class="number">100</span>;</div><div class="line">    l_success        BOOLEAN;</div><div class="line">    l_filename       VARCHAR2(<span class="number">200</span>);</div><div class="line">    l_client_path    VARCHAR2(<span class="number">2000</span>);</div><div class="line">    l_file_seperator VARCHAR2(<span class="number">10</span>);</div><div class="line">    l_bar_width      NUMBER := <span class="number">0</span>;</div><div class="line">    l_rows_total     NUMBER;</div><div class="line">    l_view_name      VARCHAR2(<span class="number">50</span>) := get_block_property(<span class="string">'B_INV_ADJ_DETAIL'</span>,</div><div class="line">                                                        query_data_source_name);</div><div class="line">    l_length_grow    NUMBER;</div><div class="line"></div><div class="line">    l_field_name VARCHAR2(<span class="number">30</span>);</div><div class="line">    curs_block   VARCHAR2(<span class="number">30</span>);</div><div class="line">    curr_item_id item;</div><div class="line">    i            NUMBER; -- <span class="keyword">for</span> the first field;</div><div class="line">    r            NUMBER; -- For the first line;</div><div class="line">    l_line_num   NUMBER;</div><div class="line">    l_check_msg  VARCHAR2(<span class="number">200</span>);</div><div class="line"></div><div class="line">    TYPE type_cur IS REF CURSOR;</div><div class="line">    c_po_line type_cur;</div><div class="line">BEGIN</div><div class="line">    IF :B_EXPORT.DI_FILEPATH IS NULL THEN</div><div class="line">    </div><div class="line">        imessage(<span class="string">'请输入文件名'</span>);</div><div class="line">        RAISE form_trigger_failure;</div><div class="line">    END IF;</div><div class="line"></div><div class="line">    set_application_property(cursor_style, <span class="string">'BUSY'</span>);</div><div class="line">    synchronize;</div><div class="line">    SELECT cmx_ifupload_history_s.nextval INTO l_file_id FROM dual;</div><div class="line">    INSERT INTO cmx_upload_db_file</div><div class="line">        (file_content, upload_id, creation_date, created_by)</div><div class="line">    VALUES</div><div class="line">        (empty_blob(), l_file_id, SYSDATE, USER);</div><div class="line">    SELECT file_content</div><div class="line">      INTO l_blob</div><div class="line">      FROM cmx_upload_db_file</div><div class="line">     WHERE upload_id = l_file_id;</div><div class="line"></div><div class="line">    IF NOT cmx_invsoh_rep.open_file(l_blob, l_error_msg) THEN</div><div class="line">        imessage(l_error_msg);</div><div class="line">        RAISE form_trigger_failure;</div><div class="line">    END IF;</div><div class="line"></div><div class="line">    --</div><div class="line"></div><div class="line">    go_block(<span class="string">'B_INV_ADJ_DETAIL'</span>);</div><div class="line">    first_record;</div><div class="line">    r          := <span class="number">1</span>;</div><div class="line">    l_line_num := <span class="number">0</span>;</div><div class="line">    LOOP</div><div class="line">    </div><div class="line">        curs_block   := name_in(<span class="string">'SYSTEM.CURSOR_BLOCK'</span>);</div><div class="line">        l_field_name := get_block_property(curs_block, first_item);</div><div class="line">        i            := <span class="number">1</span>;</div><div class="line">        l_line_num   := l_line_num + <span class="number">1</span>;</div><div class="line">        LOOP</div><div class="line">            curr_item_id := find_item(curs_block || <span class="string">'.'</span> || l_field_name);</div><div class="line">        </div><div class="line">            IF get_item_property(curr_item_id, displayed) = <span class="string">'TRUE'</span> THEN</div><div class="line">                l_check_msg := get_item_property(curs_block || <span class="string">'.'</span> ||</div><div class="line">                                                 l_field_name,</div><div class="line">                                                 prompt_text);</div><div class="line">--区分item是否为空</div><div class="line">                <span class="keyword">if</span> l_check_msg <span class="keyword">not</span> <span class="keyword">in</span></div><div class="line">                   (<span class="string">'PB_ITEM_LOV'</span>, <span class="string">'PB_ITEM_DESC_LOV'</span>, <span class="string">'PB_LOT_LOV'</span>) then</div><div class="line">                    IF i = <span class="number">1</span> THEN</div><div class="line">                        l_col_concat := <span class="string">'"'</span> || name_in(curs_block || <span class="string">'.'</span> ||</div><div class="line">                                                       l_field_name) || <span class="string">'"'</span>;</div><div class="line"> --区分是表头还是表行      </div><div class="line">                        IF r = <span class="number">1</span> THEN</div><div class="line">                            l_col_head := <span class="string">'"'</span> ||</div><div class="line">                                          get_item_property(curs_block || <span class="string">'.'</span> ||</div><div class="line">                                                            l_field_name,</div><div class="line">                                                            prompt_text) || <span class="string">'"'</span>;</div><div class="line">                        END IF;</div><div class="line">                    </div><div class="line">                        i := <span class="number">0</span>;</div><div class="line">                    ELSE</div><div class="line">                        l_col_concat := l_col_concat || <span class="string">',"'</span> ||</div><div class="line">                                        name_in(curs_block || <span class="string">'.'</span> ||</div><div class="line">                                                l_field_name) || <span class="string">'"'</span>;</div><div class="line">                    </div><div class="line">                        IF r = <span class="number">1</span> THEN</div><div class="line">                            l_col_head := l_col_head || <span class="string">',"'</span> ||</div><div class="line">                                          get_item_property(curs_block || <span class="string">'.'</span> ||</div><div class="line">                                                            l_field_name,</div><div class="line">                                                            prompt_text) || <span class="string">'"'</span>;</div><div class="line">                        END IF;</div><div class="line">                    </div><div class="line">                    END IF;</div><div class="line">                </div><div class="line">                end <span class="keyword">if</span>;</div><div class="line">            END IF;</div><div class="line">            l_field_name := get_item_property(curr_item_id, nextitem);</div><div class="line">            EXIT WHEN l_field_name IS NULL;</div><div class="line">        </div><div class="line">        END LOOP;</div><div class="line">--调用cmx_invsoh_rep.write_line_to_blob写入文件</div><div class="line">        IF r = <span class="number">1</span> THEN</div><div class="line">            l_col_head := <span class="string">'调整单号'</span> || <span class="string">','</span> || l_col_head;</div><div class="line">            IF NOT cmx_invsoh_rep.write_line_to_blob (l_blob,</div><div class="line">                                                     l_col_head,</div><div class="line">                                                     l_error_msg) THEN</div><div class="line">                imessage(l_error_msg);</div><div class="line">                RAISE form_trigger_failure;</div><div class="line">            END IF;</div><div class="line">        </div><div class="line">        END IF;</div><div class="line">        r            := <span class="number">0</span>;</div><div class="line">        l_col_concat := name_in(<span class="string">'B_HEAD.INV_ADJ_NO'</span>) || <span class="string">','</span> || l_col_concat;</div><div class="line">        IF NOT cmx_invsoh_rep.write_line_to_blob(l_blob,</div><div class="line">                                                 l_col_concat,</div><div class="line">                                                 l_error_msg) THEN</div><div class="line">            imessage(l_error_msg);</div><div class="line">            RAISE form_trigger_failure;</div><div class="line">        END IF;</div><div class="line">    </div><div class="line">        IF :system.last_record = <span class="string">'FALSE'</span> THEN</div><div class="line">            next_record;</div><div class="line">        ELSE</div><div class="line">            EXIT;</div><div class="line">        END IF;</div><div class="line">    </div><div class="line">        <span class="keyword">if</span> mod(l_line_num, <span class="number">100</span>) = <span class="number">0</span> then</div><div class="line">            synchronize;</div><div class="line">        end <span class="keyword">if</span>;</div><div class="line">    END LOOP;</div><div class="line">    synchronize;</div><div class="line">    IF NOT cmx_invsoh_rep.close_file(l_blob, l_error_msg) THEN</div><div class="line">        imessage(l_error_msg);</div><div class="line">        RAISE form_trigger_failure;</div><div class="line">    END IF;</div><div class="line">    set_application_property(cursor_style, <span class="string">'DEFAULT'</span>);</div><div class="line"></div><div class="line">    l_success := webutil_file_transfer.db_to_client_with_progress(clientfile       =&gt; :B_EXPORT.DI_FILEPATH,</div><div class="line">                                                                  tablename        =&gt; <span class="string">'CMX_UPLOAD_DB_FILE'</span>,</div><div class="line">                                                                  columnname       =&gt; <span class="string">'FILE_CONTENT'</span>,</div><div class="line">                                                                  whereclause      =&gt; <span class="string">'UPLOAD_ID = '</span> ||</div><div class="line">                                                                                      l_file_id,</div><div class="line">                                                                  progresstitle    =&gt; <span class="string">'正在生成文件'</span>,</div><div class="line">                                                                  progresssubtitle =&gt; <span class="string">'请等待'</span>);</div><div class="line">END;</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-pl-sql" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/29/pl-sql/" class="article-date">
  	<time datetime="2016-08-29T05:35:44.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/29/pl-sql/">pl sql</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PLSQL学习相关"><a href="#PLSQL学习相关" class="headerlink" title="PLSQL学习相关"></a>PLSQL学习相关</h1><hr>
<blockquote>
<p>*本资料写于15年8月初步接触EBS，用以研究存储过程和SQL相关编写规则和优化。</p>
</blockquote>
<hr>
<p><i class="icon-adjust"></i>这个知识点是初步了解plsql时接触的，参考网上相关资料编写。</p>
<h2 id="PLSQL学习相关-2015-08-10"><a href="#PLSQL学习相关-2015-08-10" class="headerlink" title="PLSQL学习相关(2015/08/10)"></a>PLSQL学习相关(2015/08/10)</h2><p>###新知识点 1：plsql简单查询和排序及其查询行函数相关知识点</p>
<p>1.1.1.    概述<br>1.1.2.    详细步骤1<br>一、编写简单的sql命令：<br>简单的sql命令的相关编写，不区分大小写，结束使用；或者/结束。<br>     例子1：创建一张表s_emp，暂时包含字段dept_id, last_name, first_name, manager_id, salary<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a.	SQL&gt;select dept_id,last_name,first_name,manager_id <span class="keyword">from</span> s_emp;（简单的查询）</div><div class="line">b.	SQL&gt;select salary*<span class="number">2</span> <span class="keyword">from</span> s_emp;（查询结果进行运算）</div></pre></td></tr></table></figure></p>
<p>二、连接符号<br>类似JAVA字符串拼接<br>      例子：提供连接符使输出结果连接在一起。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	SQL&gt;select first_name||’ ’||last_name <span class="keyword">from</span> s_emp；</div></pre></td></tr></table></figure></p>
<p>三、空值<br>处理null值，使之更有意义。<br>      例子：在特殊需求下用以取代null。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	SQL&gt;select NVL(salary,<span class="number">0</span>) <span class="keyword">from</span> s_emp where first_name=’XXX’;</div></pre></td></tr></table></figure></p>
<p>四、排序<br>用来将查询结果按照需要的排序展示,同时可以添加多列排序，在后面添加字段。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	按照薪水排序：SQL〉select * <span class="keyword">from</span> s_emp order by salary;</div></pre></td></tr></table></figure></p>
<p>五、字符型转换<br>字符型转化主要有转换小写（lower），转换大写（upper），首字母大写（initcap），选取长度（length），空值转换（NVL）。<br>六、函数相关<br>函数这边主要是函数转换，还有的四舍五入之类相对简单，可以参考相关文献。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a.	To_char:将一个数字或日期装换成char</div><div class="line">b.	To_number：将字符转换为number</div><div class="line">c.	To_date：转换为日期类型</div></pre></td></tr></table></figure></p>
<hr>
<p>###新知识点 2：从多个表格中提取数据，了解组函数</p>
<p>1.2.1.    概述<br>主要描述从多个表格中查询数据，和组函数相关知识点。<br>1.2.2.    详细步骤1<br>一、多表查询<br>多表查询主要提供从多个表格中查询出有效数据，建立s_salary和s_name表，用于存储工资和名字，通过员工号id关联。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	Select salary,name <span class="keyword">from</span> s_salary，s_name；</div></pre></td></tr></table></figure></p>
<p>二、简单连接查询<br>连接查询，查询关联的相关数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	Select salary,name <span class="keyword">from</span> s_salary，s_name wheres_salary.id=s_name.id；</div></pre></td></tr></table></figure></p>
<p>三、非等链接<br>在没有明确的关联信息的时候可以使用非等值连接。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	Select salary,name <span class="keyword">from</span> s_salary，s_name where s_salary.id between s_name.losal <span class="keyword">and</span> s_name.hisal;</div></pre></td></tr></table></figure></p>
<p>四、组函数相关<br>组函数是指按每组返回结果的函数。组函数可以出现在select和having字段中。<br>组函数：avg,count,    max,min,sum<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	SQL&gt;select AVG(salary)，COUNT(salary),MAX(salary),MIN(salary),SUM(salary) <span class="keyword">from</span> s_salary where s_salary.id=<span class="number">2</span>;</div></pre></td></tr></table></figure></p>
<hr>
<p>###新知识点 3：实现子查询和变量的使用</p>
<p>1.3.1.    概述<br>    子查询是一种SELECT句式中的高级特性，就是一个SELECT语句作为另一个语句的一个段。我们可以利用子查询来在WHERE字段中引用另一个查询来攻取值以补充其无法事先预知的子结果。<br>1.3.2.    详细步骤1<br>一、子查询的执行过程<br>例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.	SQL&gt;SELECT last_name, title FROM s_empWHERE dept_id =( SELECT dept_id FROM s_emp WHERE UPPER(last_name)=’BIRI’)</div></pre></td></tr></table></figure></p>
<p>这里 ，每个查询只运行一次。但是子查询要首先被执行，子查询的结果将作为外面查询条件。<br>二、子查询中的GROUP 函数的应用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">例子<span class="number">1</span>：选择出工资最高的员工的家庭住址</div><div class="line">SQL&gt; SELECT address FROM s_salary WHERE salary = (SELECT MAX(salary) FROM s_salary );</div><div class="line">例子<span class="number">2</span>：查询工资低于平均工资的员工</div><div class="line">SQL&gt; SELECT address FROM s_salary WHERE salary &lt; (SELECT AVG(salary) FROM s_salary );</div></pre></td></tr></table></figure></p>
<p>三、运行时应用变量应用实例<br>变量可以在运行时应用，变量可出现在WHERE 字段，文本串，列名，表名等<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">例子<span class="number">1</span>：SQL&gt;SELECT id,last_name,salary FROM s_emp WHERE dept_id = &amp;department_number；</div><div class="line">例子<span class="number">2</span>：可以在赋值前后进行比较</div><div class="line">SET VERIFY　ON</div><div class="line">SQL&gt;select * <span class="keyword">from</span> emp where lastname=<span class="string">'&amp;last_name'</span></div><div class="line">      输入 last_name的值:adopt</div><div class="line">      原值 select * <span class="keyword">from</span> emp where lastname=<span class="string">'&amp;last_name'</span></div><div class="line">      新值 select * <span class="keyword">from</span> emp where lastname=<span class="string">'adopt'</span></div></pre></td></tr></table></figure></p>
<hr>
<h3 id="新知识点-4：用户的权限控制"><a href="#新知识点-4：用户的权限控制" class="headerlink" title="新知识点 4：用户的权限控制"></a>新知识点 4：用户的权限控制</h3><p>1.4.1.    概述<br>    ORACLE通过用户名和密码进行权限控制。添加权限控制有利于维护数据的安全。<br>1.4.2.    详细步骤1<br>DBA有创建用户，删除用户，删除表格，备份表格这四个最高权限。<br>一、创建用户<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a)	CREATE USER user IDENTIFIED BY password;</div></pre></td></tr></table></figure></p>
<p>二、系统权限<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a)	CREATE SESSION Connect to the database.</div><div class="line">b)	CREATE TABLE Create tables <span class="keyword">in</span> the user’s schema.</div><div class="line">c)	CREATE SEQUENCE Create a sequence <span class="keyword">in</span> the user’s schema.</div><div class="line">d)	CREATE VIEW Create a view <span class="keyword">in</span> the user’s schema.</div><div class="line">e)	CREATE PROCEDURE Create a stored procedure, function, <span class="keyword">or</span> package <span class="keyword">in</span> the user’s schema.</div></pre></td></tr></table></figure></p>
<p>三、授予用户权限<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a)	GRANT privilege [, privilege...] TO user [, user...];</div><div class="line">b)	GRANT CREATE TABLE TO SCOTT；</div></pre></td></tr></table></figure></p>
<p>四、角色使用<br>a)    创建、授予给角色<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CREATE ROLE MANAGER；</div><div class="line">GRANT CREATE TABLE，CREATE VIEW TO MANAGER；</div><div class="line">GRANT MANAGER TO CLARK；</div></pre></td></tr></table></figure></p>
<p> 五、密码修改<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ALTER USER user IDENTIFIED BY password；</div></pre></td></tr></table></figure></p>
<hr>
<p>###新知识点 4：申明变量，执行相关语句</p>
<p>1.5.1.    详细步骤1<br>一、PLSQL块结构<br>DECLARE<br>。。。申明定义<br>BEGIN<br>。。。执行语句<br>EXCEPTION<br>。。。异常处理<br>END；<br>例子1：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DECLARE</div><div class="line">    firstname varchar2(<span class="number">20</span>);</div><div class="line">BEGIN</div><div class="line">    Select first_name int firstname </div><div class="line"><span class="keyword">from</span> s_emp where s_emp.last_name=’san’;</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>这边单行插入，如何不添加where子句汇报溢出错误。<br>二、%TYPE属性<br>     在申明变量的时候如何不知道变量的类型，可以使用XX_table.O%type来申明变量，表示变量的类型和表中该字段类型相同,这样我们不需要知道变量的类型和长度。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">例子：firstname s_emp.first_name%type;</div></pre></td></tr></table></figure></p>
<p>三、变量的赋值<br>在申明变量或者在执行语句中遇到赋值是通过：=来复制，如：<br>firstname s_emp.first_name%type：=li;<br>四、函数参数申明作用域<br>      改作用域的作用范围可以参考java局部变量和全局变量的相关理解。</p>
<p>1.6.    新知识点4：编写控制语句，接触游标<br>1.6.1.    详细步骤1<br>一、编写控制语句<br>a)    控制执行流(if语句格式与java条件循环格式相同，需注意赋值为：=)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">IF condeition THEN</div><div class="line">        Statements;</div><div class="line">END IF</div></pre></td></tr></table></figure></p>
<p>b)    注意逻辑运算对应关系（NOT、AND、OR，且表达式中有空值都为NULL，且连接字符串中含有空值会将NULL作为空字符串）<br>c)    基本循环（写在执行块里面）<br>LOOP 。。执行语句。。EXIT[WHEN 。。条件。];  END LOOP;<br>d)    FOR循环（写在执行块里面）<br>For 参数 IN 条件 LOOP<br>执行语句。。<br>END LOOP<br>e)    While 循环（写在执行块里面）<br>While 条件 LOOP<br>执行语句。。<br>END LOOP<br>f)    嵌套循环(嵌套方式和java相似)但是可以用&lt;<label>&gt;做循环的标签<br>二、游标操控数据<br>a)    游标分为两种，显式游标和隐式游标<br>i.    显示游标需要先申明游标，然后打开游标，然后取出数据，最后关闭游标。声明方式CURSOR_NAME IS SELECT STATMENT，游标的打开使用OPEN CURSOR_NAME语句，取出游标中的数据使FETCH CURSOR_NAME INTO RECOR-LIST，关闭游标则使用CLOSE CURSOR_NAME。<br>例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">DECLARE</div><div class="line">     MYNAME VARCHAR(<span class="number">22</span>);</div><div class="line">CURSOR C_NAME IS</div><div class="line">     SELECT ENAME FORM EMP;</div><div class="line">BEGIN</div><div class="line">     IF NOT C_NAME%ISOPEN THEN</div><div class="line">          OPEN C_NAME</div><div class="line">     END IF;</div><div class="line">    LOOP </div><div class="line">          FETCH C_NAME INTO MYNAME;</div><div class="line">          DBMS_OUTPUT.PUT_LINE(MYNAME);</div><div class="line">          EXIT WHEN C_NAME%NOTFOUND;</div><div class="line">    END LOOP;</div><div class="line">    CLOSE C_NAME;</div><div class="line">END;</div></pre></td></tr></table></figure></label></p>
<p>如上所示，通过CURSOR来申明游标，通过open 游标名来打开游标，使用fetch 游标名 into 变量来取出数据，最后需要使用close 游标名来关闭游标。</p>
<hr>
<p>###问题1:function与procedure的区别<br>1.7.1.    问题描述<br>问题一。看到一些程序的代码里面有的用的function有的用的procedure，防止2这混淆，单独列出来。<br>1.7.2.    解决思路<br>参考程序和网上的案例理解区别。<br>function可以使用表达式中x:=func()； procedure不能使用。<br>Function可以作为表达式select func() from dual; procedure不能。<br>Function不能BEGIN func（）;END; ; procedure可以。<br>列出2个例子先初步区分<br>例子1：function案例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">SQL&gt;create <span class="keyword">or</span> replace function func(v_name <span class="keyword">in</span> varchar2) </div><div class="line">          <span class="keyword">return</span> varchar2</div><div class="line">          Is</div><div class="line">       Begin</div><div class="line">       <span class="keyword">return</span>(v_name||<span class="string">' hello'</span>); </div><div class="line">       End</div><div class="line">调用function：</div><div class="line">SQL&gt;DECLARE v_name varchar2(<span class="number">20</span>);</div><div class="line">       BEGIN v_name:=func(<span class="string">'cheng'</span>);</div><div class="line">                 dbms_output.put_line(v_name);</div><div class="line">       END;</div><div class="line">输出结果：cheng hello</div></pre></td></tr></table></figure></p>
<p>例子2：procedure 案例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">create <span class="keyword">or</span> replace procedure say_hello(</div><div class="line">  	i_name <span class="keyword">in</span> varchar2,</div><div class="line">     。。。</div><div class="line">)</div><div class="line"><span class="keyword">as</span></div><div class="line">  v_name varchar2(<span class="number">100</span>);</div><div class="line">。。。</div><div class="line">begin</div><div class="line"> 	函数块</div><div class="line">end;</div></pre></td></tr></table></figure></p>
<p>调用方法直接使用exec过程名（参数1，参数2。。）<br>例子3：procedure案例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">create <span class="keyword">or</span> replace procedure test <span class="keyword">is</span></div><div class="line">  cursor data_cur <span class="keyword">is</span></div><div class="line">    select * <span class="keyword">from</span> wh where rownum &lt; <span class="number">10</span>;</div><div class="line">begin</div><div class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> data_cur loop</div><div class="line">    dbms_output.put_line(i.wh_name);</div><div class="line">  end loop;</div><div class="line">  /*begin</div><div class="line">  exception</div><div class="line">    when no_data_found then</div><div class="line">      null;</div><div class="line">    when too_many_rows then</div><div class="line">      null;</div><div class="line">    when others then</div><div class="line">      null;</div><div class="line">  end;*/</div><div class="line">end test;</div></pre></td></tr></table></figure></p>
<p>创建一个存储过程test将表wh中rownum<10的数据查出并显示出来。同时显示异常处理的三种类型。 调用执行存储过程：="" <figure="" class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">begin</div><div class="line">  -- Call the procedure</div><div class="line">  test;</div><div class="line">end;</div></pre></td></tr></table></10的数据查出并显示出来。同时显示异常处理的三种类型。></p>
<table>
<thead>
<tr>
<th>运行结果输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>宁夏药品公司批发正常仓</td>
</tr>
<tr>
<td>宁夏药品公司批发正常仓</td>
</tr>
<tr>
<td>宁夏药品公司退货在途仓（国药国大)</td>
</tr>
<tr>
<td>宁夏药品公司</td>
</tr>
<tr>
<td>广西国大冷链仓</td>
</tr>
<tr>
<td>泉州国大物流仓</td>
</tr>
<tr>
<td>泉州国大清濛仓</td>
</tr>
<tr>
<td>泉州国大正常仓</td>
</tr>
</tbody>
</table>
<p>参考来源<a href="http://blog.csdn.net/liyisong2008/article/details/8086952" target="_blank" rel="external">http://blog.csdn.net/liyisong2008/article/details/8086952</a></p>
<p>1.7.3.    解决过程补充<br>如果后面解决了，回头来补充。<br>………………</p>
<hr>
<p>###问题2:显示游标和隐式游标的区别<br>1.8.1.<br>问题描述<br>查看的例子中没有详细解释区别，只是略微带过。<br>1.8.2.<br>解决思路<br>查看网络案例和解析区分。<br>显示游标在上面有例子，这里简单举例隐式游标。<br>隐式游标的名称是SQL，不能对SQL游标显式地执行OPEN,FETCH,CLOSE语句。隐式游标也有四个属性SQL%ISOPEN，SQL%FOUND，SQL%ROWCOUNT，SQL%NOTFOUND。前三种都是boolen类型，最后一个在执行任何DML语句之前，都是NULL。<br>例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">DECLARE</div><div class="line">v_empno emp.empno%TYPE := &amp;no;</div><div class="line">BEGIN</div><div class="line">  UPDATE emp</div><div class="line">     SET sal = sal + <span class="number">200</span> --根据给定的empno，更新一条记录</div><div class="line">   WHERE empno = v_empno;</div><div class="line">  IF SQL%FOUND THEN</div><div class="line">    --使用SQL游标属性SQL%FOUND作为判断条件</div><div class="line">COMMIT;</div><div class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">'SQL code is executed successful'</span>);</div><div class="line">  ELSE</div><div class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">'The Employee is not exist'</span>);</div><div class="line">    ROLLBACK;</div><div class="line">  END IF;</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<pre><code>输入：78 显示The Employee is not exist
</code></pre><p>输入7788显示SQL code is executed successful<br>由于隐式游标的返回值前三种均为boolen类型，使用可以直接用于判断，通过返回的值显示不同的结果。<br><i class="icon-chevron-sign-left"></i>参考来源:<a href="http://blog.csdn.net/leshami/article/details/6092066" target="_blank" rel="external">http://blog.csdn.net/leshami/article/details/6092066</a></p>
<p>1.8.3.<br>解决过程补充<br>如果后面解决了，回头来补充。<br>………………</p>
<hr>
<p>1.9.    个人总结<br>1.9.1.     本周总结<br>自我发挥，当着自己的总结。<br>大致了解plsql的语法格式和基本使用方式，很多细节应该还有问题，参考实例和一些帖子查看。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Jemes Zhou
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: undefined,
		mathjax: undefined,
		animate: undefined,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: undefined,
		root: /
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






  </div>
</body>
</html>